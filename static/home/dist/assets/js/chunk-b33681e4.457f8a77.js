(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b33681e4"],{"307f":function(e,s,t){"use strict";t.r(s);var r=function(){var e=this,s=e._self._c;return s("div",{staticClass:"page_exam",attrs:{id:"exam_view"}},[e.$check_exam("/exam/list","answers")?s("div",{staticClass:"warp"},[s("div",{staticClass:"container exam-detail"},[s("div",{staticClass:"row"},[e.if_answered?e._e():s("div",{staticClass:"countdown"},[e._v(" 距离考试结束还有："),s("span",[e._v(e._s(e.minutes+":"+e.seconds))])]),s("div",{staticClass:"col-24 col-lg-24 col-md-24"},[e.if_answered?s("div",{staticClass:"col-24 col-lg-24 col-md-24"},[0===e.score_state?s("div",{staticClass:"title_margin",staticStyle:{"margin-bottom":"20px"}},[e._v(" 未评分 ")]):s("div",{staticClass:"title_margin",staticStyle:{"margin-bottom":"20px"}},[e._v(" 已评分，得分："),s("span",{staticStyle:{color:"red"}},[e._v(e._s(e.answer_form.score))])])]):e._e()]),e._l(e.question_list,(function(t,r){return s("div",{key:t},["单选题"===t.type?s("div",{staticClass:"title_margin"},[e._v(" "+e._s(t.question_order+".单选题："+t.title+" ("+t.score+"分)")+" "),e.if_answered?s("span",{staticClass:"score_show"},[e._v("--------"+e._s(e.answer_scores[r])+"分")]):e._e()]):"多选题"===t.type?s("div",{staticClass:"title_margin"},[e._v(" "+e._s(t.question_order+".多选题："+t.title+" ("+t.score+"分)")+" "),e.if_answered?s("span",{staticClass:"score_show"},[e._v("--------"+e._s(e.answer_scores[r])+"分")]):e._e()]):"判断题"===t.type?s("div",{staticClass:"title_margin"},[e._v(" "+e._s(t.question_order+".判断题："+t.title+" ("+t.score+"分)")+" "),e.if_answered?s("span",{staticClass:"score_show"},[e._v("--------"+e._s(e.answer_scores[r])+"分")]):e._e()]):"填空题"===t.type?s("div",{staticClass:"title_margin"},[e._v(" "+e._s(t.question_order+".填空题："+t.title+" ("+t.score+"分)")+" "),e.if_answered?s("span",{staticClass:"score_show"},[0===e.score_state?s("span",[e._v("--------未评分")]):s("span",[e._v("--------"+e._s(e.answer_scores[r])+"分")])]):e._e()]):s("div",{staticClass:"title_margin"},[e._v(" "+e._s(t.question_order+".主观题："+t.title+" ("+t.score+"分)")+" "),e.if_answered?s("span",{staticClass:"score_show"},[0===e.score_state?s("span",[e._v("--------未评分")]):s("span",[e._v("--------"+e._s(e.answer_scores[r])+"分")])]):e._e()]),"单选题"===t.type?s("div",[e._l(e.get_question_list(t.question_item),(function(i){return s("label",{staticStyle:{"margin-right":"20px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.answers[r],expression:"answers[i]"}],attrs:{disabled:e.if_answered,name:t.title,type:"radio"},domProps:{value:i,checked:e._q(e.answers[r],i)},on:{change:function(s){return e.$set(e.answers,r,i)}}}),e._v(e._s(i)+" ")])})),e.if_answered&&e.reference_answers[r]?s("div",{staticClass:"score_show"},[e._v(" 参考答案："+e._s(e.reference_answers[r])+" ")]):e._e()],2):"多选题"===t.type?s("div",[e._l(e.get_question_list(t.question_item),(function(i){return s("label",{staticStyle:{"margin-right":"20px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.answers[r],expression:"answers[i]"}],attrs:{disabled:e.if_answered,name:t.title,type:"checkbox"},domProps:{value:i,checked:Array.isArray(e.answers[r])?e._i(e.answers[r],i)>-1:e.answers[r]},on:{change:function(s){var t=e.answers[r],a=s.target,n=!!a.checked;if(Array.isArray(t)){var _=i,o=e._i(t,_);a.checked?o<0&&e.$set(e.answers,r,t.concat([_])):o>-1&&e.$set(e.answers,r,t.slice(0,o).concat(t.slice(o+1)))}else e.$set(e.answers,r,n)}}}),e._v(e._s(i)+" ")])})),e.if_answered&&e.reference_answers[r]?s("div",{staticClass:"score_show"},[e._v(" 参考答案："+e._s(e.reference_answers[r])+" ")]):e._e()],2):"判断题"===t.type?s("div",[e._l(e.get_question_list(t.question_item),(function(i){return s("label",{staticStyle:{"margin-right":"20px"}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.answers[r],expression:"answers[i]"}],attrs:{disabled:e.if_answered,name:t.title,type:"radio"},domProps:{value:i,checked:e._q(e.answers[r],i)},on:{change:function(s){return e.$set(e.answers,r,i)}}}),e._v(e._s(i)+" ")])})),e.if_answered&&e.reference_answers[r]?s("div",{staticClass:"score_show"},[e._v(" 参考答案："+e._s(e.reference_answers[r])+" ")]):e._e()],2):"填空题"===t.type?s("div",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.answers[r],expression:"answers[i]"}],staticStyle:{width:"500px"},attrs:{name:t.title,disabled:e.if_answered},domProps:{value:e.answers[r]},on:{input:function(s){s.target.composing||e.$set(e.answers,r,s.target.value)}}}),e.if_answered?s("div",{staticClass:"score_show"},[e._v(" 参考答案："+e._s(e.reference_answers[r])+" ")]):e._e()]):"主观题"===t.type?s("div",[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.answers[r],expression:"answers[i]"}],staticStyle:{width:"500px"},attrs:{name:t.title,type:"",disabled:e.if_answered,rows:"3",cols:"20"},domProps:{value:e.answers[r]},on:{input:function(s){s.target.composing||e.$set(e.answers,r,s.target.value)}}}),e.if_answered?s("div",{staticClass:"score_show"},[e._v(" 参考答案："+e._s(e.reference_answers[r])+" ")]):e._e()]):e._e()])})),s("div",{staticClass:"title_margin"},[s("div",[s("span",[e._v("提交人：")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.submit_user_str,expression:"submit_user_str"}],staticStyle:{width:"500px"},attrs:{disabled:!0},domProps:{value:e.submit_user_str},on:{input:function(s){s.target.composing||(e.submit_user_str=s.target.value)}}})])])],2),s("div",{staticClass:"row answer_submit_button"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"btn_box"},[e.if_answered?e._e():s("button",{staticClass:"answer_btn_submit",on:{click:function(s){return e.submit()}}},[e._v(" 提交 ")]),s("button",{staticClass:"answer_btn_cancel",on:{click:function(s){return e.cancel()}}},[e._v("取消")])])])])])]):e._e()])},i=[],a=t("c6e7"),n={mixins:[a["a"]],components:{},data(){return{field:"exam_id",url_add:"~/api/subject_user_answer/add?",url_set:"~/api/subject_user_answer/set?",url_get_obj:"~/api/subject_exam/get_obj?",url_upload:"~/api/subject_user_answer/upload?",query:{exam_id:0},form:{exam_id:0,name:"",duration:0,score:0,status:"启用"},url_get_question_list:"~/api/subject_exam_question/get_list?",url_get_exam_question:"~/api/subject_exam_question/get_obj?",url_add_user_answer_wrong:"~/api/user_answer_wrong/add?",question_list:[],answers:[],submit_user_str:"",answer_form:{user_answer_id:0,user_id:0,exam_id:0,score:0,score_state:0,answers:[],score_detail:[],objective_score:0,subjective_score:0,nickname:""},answer_wrong_form:{user_answer_id:0,subject_name:"",user_id:0,type:"",title:"",question_item:"",exam_id:0,score:0,score_state:0,answers:[],answer:"",objective_score:0,subjective_score:0,nickname:""},if_answered:!1,maxtime:0,minutes:0,seconds:0,timer:"",score_state:0,answer_scores:[],reference_answers:[]}},methods:{async get_obj_after(){let e=await this.$get("~/api/user/get_obj?user_id="+this.$store.state.user.user_id);e.result?(this.submit_user_str=e.result.obj.username+"-"+e.result.obj.nickname,this.answer_form.user_id=e.result.obj.user_id,this.answer_form.nickname=e.result.obj.nickname):e.error&&console.error(e.error);let s=await this.$get(this.url_get_question_list+"exam_id="+this.query.exam_id+"&orderby=question_order");if(s.result){this.question_list=s.result.list;for(let e=0;e<this.question_list.length;e++)"多选题"===this.question_list[e].type?this.answers[e]=[]:this.answers[e]=""}else s.error&&console.error(s.error);let t=await this.$get("~/api/subject_user_answer/get_obj?user_id="+this.answer_form.user_id+"&exam_id="+this.query.exam_id);if(t.result&&null!=t.result.obj){this.answer_form=t.result.obj,this.score_state=t.result.obj.score_state,this.answer_form.answers=JSON.parse(this.answer_form.answers),this.answer_form.score_detail=JSON.parse(this.answer_form.score_detail);for(let e=0;e<this.answer_form.answers.length;e++)this.answers[e]=this.answer_form.answers[e].answer,this.answer_scores[e]=this.answer_form.score_detail[e].score,"单选题"===this.question_list[e].type||"判断题"===this.question_list[e].type||"多选题"===this.question_list[e].type?this.answer_scores[e]!==this.question_list[e].score&&(this.reference_answers[e]=this.question_list[e].answer):this.reference_answers[e]=this.question_list[e].answer;this.if_answered=!0}else t.error&&console.error(t.error);this.if_answered||(this.maxtime=60*this.form.duration,this.timer=window.setInterval(()=>{setTimeout(this.set_countdown(),0)},1e3))},get_question_list(e){let s=e.split("\n");return s},get_answer_wrong_by_id(e,s){let t=JSON.parse(e);for(let r=0;r<t.length;r++){let e=t[r];if(e.exam_question_id==s)return console.log(e),e}return null},async post_user_answer_wrong(){for(let e=0;e<this.question_list.length;e++){let s=this.question_list[e];if(s.exam_question_id){let e=await this.$get(this.url_get_exam_question+"exam_question_id="+s.exam_question_id);if(e.result){this.answer_wrong_form.subject_name=e.result.obj.subject_name,this.answer_wrong_form.title=e.result.obj.title,this.answer_wrong_form.nickname=this.answer_form.nickname,this.answer_wrong_form.type=e.result.obj.type,this.answer_wrong_form.user_id=this.$store.state.user.user_id,this.answer_wrong_form.answer=e.result.obj.answer.length>0?e.result.obj.answer:"";let t=this.get_answer_wrong_by_id(this.answer_form.answers,s.exam_question_id);this.answer_wrong_form.answers=JSON.stringify(t.answer),this.answer_wrong_form.question_item=e.result.obj.question_item}this.$post(this.url_add_user_answer_wrong,this.answer_wrong_form,(function(e,s){console.log("提交错题结果：",e)}))}}},submit_main(){let e=this;e.answer_form.exam_id=e.query.exam_id;for(let t=0;t<e.answers.length;t++){let s={exam_question_id:e.question_list[t].exam_question_id,answer:e.answers[t]};if(e.answer_form.answers[t]=s,"单选题"===e.question_list[t].type||"判断题"===e.question_list[t].type)if(e.answers[t]===e.question_list[t].answer){let s={exam_question_id:e.question_list[t].exam_question_id,score:e.question_list[t].score};e.answer_form.score_detail[t]=s,e.answer_form.objective_score=e.answer_form.objective_score+e.question_list[t].score}else{let s={exam_question_id:e.question_list[t].exam_question_id,score:0};e.answer_form.score_detail[t]=s}else if("多选题"===e.question_list[t].type){let s=!0,r=e.question_list[t].answer.split("|");if(e.answers[t].length!==r.length)s=!1;else for(let i=0;i<r.length;i++)if(-1===e.answers[t].indexOf(r[i])){s=!1;break}if(s){let s={question_id:e.question_list[t].question_id,score:e.question_list[t].score};e.answer_form.score_detail[t]=s,e.answer_form.objective_score=parseFloat(e.answer_form.objective_score)+parseFloat(e.question_list[t].score)}else{let s={question_id:e.question_list[t].question_id,score:0};e.answer_form.score_detail[t]=s}}else{let s={question_id:e.question_list[t].question_id,score:0};e.answer_form.score_detail[t]=s}}e.answer_form.answers=JSON.stringify(e.answer_form.answers),e.answer_form.score_detail=JSON.stringify(e.answer_form.score_detail),e.answer_form.score=parseFloat(e.answer_form.subjective_score)+parseFloat(e.answer_form.objective_score);let s=e.url_add;this.post_user_answer_wrong(),this.$post(s,e.answer_form,(function(s,t){console.log("提交结果：",s),s.result?e.events("submit_after",s,null):s.error&&e.$toast(s.error.message,"danger")}))},set_countdown(){this.maxtime>=0?(this.minutes=Math.floor(this.maxtime/60),this.seconds=Math.floor(this.maxtime%60),--this.maxtime):(clearInterval(this.timer),alert("时间到，结束!"))}},mounted(){}},_=n,o=(t("a1b0"),t("0b56")),l=Object(o["a"])(_,r,i,!1,null,"02521984",null);s["default"]=l.exports},"862c":function(e,s,t){},a1b0:function(e,s,t){"use strict";t("862c")}}]);