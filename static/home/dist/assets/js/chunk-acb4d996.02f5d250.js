(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-acb4d996"],{"064c":function(t,s,e){},"0ff7":function(t,s,e){"use strict";var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"list_comment"},t._l(t.list,(function(e,i){return s("div",{key:i,staticClass:"item_comment_box"},[s("div",{staticClass:"comment"},[s("div",{staticClass:"left_block"},[s("img",{directives:[{name:"default-img",rawName:"v-default-img",value:"../../../public/img/default.png",expression:"'../../../public/img/default.png'"}],staticStyle:{width:"4rem",height:"4rem"},attrs:{src:t.$fullUrl(e[t.vm.avatar])}})]),s("div",{staticClass:"right_block"},[s("div",{staticClass:"top_comment"},[s("div",{staticClass:"nickname"},[t._v(t._s(e[t.vm.nickname]))]),s("div",{staticClass:"time_block"},[s("div",{staticClass:"time"},[t._v(" "+t._s(t._f("formatDate")(e[t.vm.create_time]))+" ")])])]),s("div",{staticClass:"content",domProps:{innerHTML:t._s(e[t.vm.content])}}),Object.keys(t.obj).length?s("div",{staticClass:"comment_reply"},[s("b-button",{attrs:{variant:"outline"},on:{click:function(s){return t.reply_to_sb(e)}}},[t._v("回复")])],1):t._e()])]),e.list_reply?s("div",{staticClass:"list_reply ml-5"},t._l(e.list_reply,(function(e,i){return s("div",{key:i,staticClass:"mb"},[s("div",{staticClass:"fl"},[s("span",{staticClass:"nickname"},[t._v(t._s(e[t.vm.nickname]))])]),s("div",{staticClass:"fr"},[s("span",{staticClass:"time"},[t._v(t._s(t._f("formatDate")(e[t.vm.create_time])))])]),s("div",{staticClass:"ml-5",domProps:{innerHTML:t._s(e[t.vm.content])}})])})),0):t._e()])})),0)},r=[],o=e("c6e7"),a={mixins:[o["a"]],props:{list:{type:Array,default:function(){return[]}},obj:{type:Object,default:function(){return{}}},vm:{type:Object,default:function(){return{avatar:"avatar",nickname:"nickname",content:"content",create_time:"create_time"}}}},data(){return{text:""}},methods:{reply_to_sb(t){this.obj.reply_to_id=t.comment_id}},components:{}},l=a,n=(e("8b6b"),e("0b56")),_=Object(n["a"])(l,i,r,!1,null,"a81eecfc",null);s["a"]=_.exports},"158d":function(t,s,e){"use strict";e("41da")},"30d7":function(t,s,e){"use strict";e("064c")},"41da":function(t,s,e){},"56c9":function(t,s,e){"use strict";var i=function(){var t=this,s=t._self._c;return t.publish_flag?s("div",{staticClass:"form_editor"},[s("div",{staticClass:"editor"},[s("quill-editor",{staticClass:"form_editor_block",model:{value:t.form.content,callback:function(s){t.$set(t.form,"content","string"===typeof s?s.trim():s)},expression:"form.content"}})],1),s("div",{staticClass:"btn_publish"},[s("b-button",{attrs:{variant:"outline-primary",block:""},on:{click:function(s){return t.publish()}}},[s("span",[t._v("发表")])])],1)]):t._e()},r=[],o=e("c6e7"),a={mixins:[o["a"]],props:{form:{type:Object,default(){return{content:""}}},post_url:{type:String,default(){return""}},publish_flag:{type:Boolean,default(){return!0}}},data(){return{}},methods:{async publish(){if(this.user.user_id){var t=this.form;if(t=Object.assign(t,{user_id:this.user.user_id,avatar:this.user.avatar,nickname:this.user.nickname}),t.content){var s=await this.filterSensitiveWords(t.content);if(s.length>0)this.$toast("当前消息中包含敏感词: "+s.join(","));else{var e=this.post_url;e||(e="~/api/comment/add?"),this.$post(e,t,t=>{t.result?(this.$emit("update_comment"),this.form.content=""):t.error&&this.$toast(t.error.message)})}}else this.$toast("输入内容不能为空")}else this.$router.push("/account/login")}},components:{}},l=a,n=(e("9ce5"),e("0b56")),_=Object(n["a"])(l,i,r,!1,null,"7c3a8630",null);s["a"]=_.exports},"8b6b":function(t,s,e){"use strict";e("ec52")},"9ce5":function(t,s,e){"use strict";e("c1b1")},c1b1:function(t,s,e){},cc48:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"diy_details page_popular_songs",attrs:{id:"popular_songs_details"}},[s("div",{staticClass:"warp_dt_box"},[s("div",{staticClass:"warp"},[s("div",{staticClass:"container"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("div",{staticClass:"card_popular_songs"},[s("div_popular_songs",{attrs:{obj:t.obj}})],1)])])])]),t.$check_action("/comment/list","get")?s("div",{staticClass:"warp"},[s("div",{staticClass:"container"},[s("div",{staticClass:"row review"},[s("div",{staticClass:"col"},[t.list_comment.length?s("bar_title",{staticClass:"mt",attrs:{title:"评论区"}}):t._e(),t.list_comment.length?s("div",{staticClass:"comment_box"},[s("list_comment",{staticClass:"w-100",attrs:{list:t.list_comment,obj:t.form_comment}}),s("b-pagination-nav",{attrs:{"base-url":t.$route.path,"number-of-pages":t.count_pages,"link-gen":t.link_gen,"first-number":"","last-number":""},on:{change:t.change_page}})],1):t._e(),s("div",{staticClass:"form_editor form_edit_box"},[s("div",{staticClass:"details_form_editor_title"},[t._v("发表评论")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.form_comment.reply_to_id,expression:"form_comment.reply_to_id"}],staticClass:"fl ml-3 answer_title"},[t._v(" 对 "),s("i",[t._v(t._s(t.respondent))]),t._v(" 回复: ")]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.form_comment.reply_to_id,expression:"form_comment.reply_to_id"}],staticClass:"fr mr-3"},[s("b-button",{attrs:{variant:"outline-primary reset_answer_personnel",size:"sm"},on:{click:function(s){t.form_comment.reply_to_id=0}}},[t._v("重置回复人 ")])],1),s("form_editor",{staticClass:"fn",attrs:{form:t.form_comment},on:{update_comment:t.update_comment}})],1)],1)])])]):t._e()])])},r=[],o=function(){var t=this,s=t._self._c;return s("div",{staticClass:"diy_details_box diy_div_popular_songs"},[s("div",{staticClass:"warp diy_warp"},[s("div",{staticClass:"container"},[s("div",{staticClass:"details_title"},[t._v("详情")]),s("div",{staticClass:"row row_det"},[s("div",{staticClass:"row_top_wrap"},[t.imgList.length?s("div",{staticClass:"row_1"},t._l(t.imgList,(function(e,i){return s("div",{key:e+i,staticClass:"diy_img"},[s("img",{attrs:{src:t.$fullUrl(t.obj[e.name])}})])})),0):t._e(),s("div",{staticClass:"row_2",class:{flex_row2:!t.imgList.length}},[t._l(t.itemList,(function(e,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.$check_field("get",e.name),expression:"$check_field('get',item.name)"}],key:e+i,staticClass:"row_cont",class:{flex_row2_item:!t.imgList.length}},[s("div",{staticClass:"view"},[s("div",{staticClass:"diy_title"},[s("span",[t._v(t._s(e.title)+":")])]),"UID"==e.type?s("div",{staticClass:"diy_field diy_uid",class:{flex_row2_item_text:t.imgList.length}},[s("span",[t._v(" "+t._s(t.get_user_info(e.name,t.obj[e.name]))+" ")])]):"视频"==e.type?s("div",{staticClass:"diy_field diy_video",class:{flex_row2_item_text:t.imgList.length}},[t.obj[e.name]?s("router-link",{attrs:{to:"/media/video?filename="+t.$fullUrl(t.obj[e.name])}},[s("span",[t._v(" 查看视频 ")])]):t._e()],1):"音频"==e.type?s("div",{staticClass:"diy_field diy_music",class:{flex_row2_item_text:t.imgList.length}},[t.obj[e.name]?s("audio",{staticStyle:{"text-align":"left"},attrs:{src:t.$fullUrl(t.obj[e.name]),controls:""}}):t._e()]):"文件"==e.type?s("div",{staticClass:"diy_field diy_music",class:{flex_row2_item_text:t.imgList.length}},[s("a",{staticStyle:{color:"rgb(64, 158, 255)"},attrs:{href:t.$fullUrl(t.obj[e.name]),target:"_blank"}},[t._v("点击下载")])]):"日期"==e.type?s("div",{staticClass:"diy_field diy_date",class:{flex_row2_item_text:t.imgList.length}},[s("span",[t._v(" "+t._s(t.$toTime(t.obj[e.name],"yyyy-MM-dd"))+" ")])]):"时间"==e.type?s("div",{staticClass:"diy_field diy_time",class:{flex_row2_item_text:t.imgList.length}},[s("span",[t._v(" "+t._s(t.$toTime(t.obj[e.name],"hh:mm:ss"))+" ")])]):"日长"==e.type?s("div",{staticClass:"diy_field diy_datetime",class:{flex_row2_item_text:t.imgList.length}},[s("span",[t._v(" "+t._s(t.$toTime(t.obj[e.name],"yyyy-MM-dd hh:mm:ss"))+" ")])]):"电话"==e.type||"手机"==e.type?s("div",{staticClass:"diy_field diy_phone",class:{flex_row2_item_text:t.imgList.length}},[s("span",[t._v(" "+t._s(t.obj[e.name])+" ")])]):"数字"==e.type?s("div",{staticClass:"diy_field diy_number",class:{flex_row2_item_text:t.imgList.length}},[s("span",[t._v(" "+t._s(t.obj[e.name])+" ")])]):"网址"==e.type?s("div",{staticClass:"diy_field diy_url",class:{flex_row2_item_text:t.imgList.length}},[s("div",[s("a",{staticStyle:{color:"rgb(64, 158, 255)"},attrs:{href:t.obj[e.name],target:"_blank"}},[t._v(t._s(t.obj[e.name]))])])]):"多文本"==e.type?s("div",{staticClass:"diy_field diy_desc",class:{flex_row2_item_text:t.imgList.length}},[s("div",[t._v(" "+t._s(t.obj[e.name])+" ")])]):s("div",{staticClass:"diy_field diy_text",class:{flex_row2_item_text:t.imgList.length}},[s("span",[t._v(" "+t._s(t.obj[e.name])+" ")])])])])})),s("div",{staticClass:"view praise_wrap"},[s("span",{staticClass:"diy_title"},[t._v("点赞数：")]),t._v(" "),s("span",{staticClass:"diy_field diy_text"},[t._v(" "+t._s(t.praiseLen)+" ")])])],2)]),s("div",{staticClass:"details_btn_wrap"},[t.$check_action("/music_evaluation/edit","add")?s("button",{staticClass:"btn btn-primary details_btn",on:{click:function(s){return t.to_form("/music_evaluation/edit")}}},[s("span",[t._v(" 评分")])]):t._e(),t.$check_action("/popular_songs/details","set")?s("button",{staticClass:"btn btn-primary details_btn",on:{click:function(s){return t.change_praise()}}},[s("span",[t._v("点赞")])]):t._e(),t.$check_action("/popular_songs/details","set")?s("button",{staticClass:"btn btn-primary details_btn",on:{click:function(s){return t.change_collect()}}},[s("span",[t._v("收藏")])]):t._e()]),t._l(t.richList,(function(e,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.$check_field("get",e.name),expression:"$check_field('get',item.name)"}],key:e+i,staticClass:"rich_text"},[s("div",{staticClass:"view"},[s("div",{staticClass:"diy_title"},[s("span",{domProps:{textContent:t._s(e.title)}})]),s("div",{staticClass:"diy_html",domProps:{innerHTML:t._s(t.obj[e.name])}})])])}))],2)])])])},a=[],l=e("6265"),n=e("c6e7"),_={mixins:[l["a"],n["a"]],components:{},props:{obj:{type:Object,default:function(){return{}}}},data(){return{praiseLen:this.obj["praise_len"],imgList:[{title:"歌手照片",name:"singer_photos",type:"图片"}],itemList:[{title:"歌曲名称",name:"song_title",type:"文本"},{title:"音乐类型",name:"music_genre",type:"下寻"},{title:"歌手姓名",name:"singer_name",type:"文本"},{title:"发行时间",name:"release_time",type:"日期"},{title:"专辑名称",name:"album_name",type:"文本"},{title:"播放数量",name:"playback_quantity",type:"数字"},{title:"音乐音频",name:"music_audio",type:"音频"}],richList:[{title:"音乐简介",name:"music_introduction",type:"多文本"},{title:"音乐内容",name:"music_content",type:"多文本"}]}},methods:{get_user_info(t,s){var e=null,i="";return e&&(i=e.nickname+"-"+e.username),i},change_praise(t){var s=this.user.user_id,e={source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj["popular_songs_id"],user_id:s},i=this;this.state_praise?(this.state_praise=!1,this.$get("~/api/praise/del?",e,t=>{if(t.result){i.praiseLen=parseInt(i.praiseLen)-1;var s=i.praiseLen;this.$post("~/api/popular_songs/set?popular_songs_id="+i.obj["popular_songs_id"],{praise_len:s},t=>{t.result?console.log("添加点赞数状态：",t.result):t.error&&console.error(t.error)}),this.$message.success("取消点赞")}else t.error&&(this.$toast(t.error.message),console.error(t.error))})):(this.state_praise=!0,this.$post("~/api/praise/add?",e,t=>{if(t.result){i.praiseLen=parseInt(i.praiseLen)+1;var s=i.praiseLen;this.$post("~/api/popular_songs/set?popular_songs_id="+i.obj["popular_songs_id"],{praise_len:s},t=>{t.result?console.log("添加点赞数状态：",t.result):t.error&&console.error(t.error)}),this.$message.success("点赞成功")}else t.error&&(this.$toast(t.error.message),console.error(t.error))}))},get_praise(){var t=this.$store.state.user.user_id;this.$get("~/api/praise/count?",{source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj.popular_songs_id,user_id:t},t=>{t.result||0===t.result?(console.log("sadsfasf"+JSON.stringify(t)),this.state_praise=!!t.result,console.log("点赞状态：",this.state_praise)):t.error&&(this.$toast(t.error.message),console.error(t.error))})},change_collect(){var t=this.user.user_id,s={source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj["popular_songs_id"],user_id:t};this.state_collect?(this.state_collect=!1,this.$get("~/api/collect/del?",s,t=>{t.result?this.$message.success("取消收藏"):t.error&&(this.$toast(t.error.message),console.error(t.error))})):(this.state_collect=!0,s.title=this.obj.song_title,s.img=this.obj.singer_photos,this.$post("~/api/collect/add?",s,t=>{t.result?this.$message.success("收藏成功"):t.error&&(this.$toast(t.error.message),console.error(t.error))}))},check_collect(){var t=this.$store.state.user.user_id,s=this.obj.popular_songs_id;this.$get("~/api/collect/count?",{user_id:t,source_table:"popular_songs",source_field:"popular_songs_id",source_id:s},t=>{this.state_collect=t.result})}},created(){setTimeout(()=>{this.get_praise(),this.check_collect()},1e3)},watch:{obj:{deep:!0,handler(){this.praiseLen=this.obj["praise_len"]}}}},c=_,p=(e("30d7"),e("0b56")),u=Object(p["a"])(c,o,a,!1,null,null,null),d=u.exports,m=e("0ff7"),g=e("a3ca"),h=e("56c9"),v={mixins:[n["a"]],components:{list_comment:m["a"],bar_title:g["a"],form_editor:h["a"],div_popular_songs:d},data(){return{url_get_obj:"~/api/popular_songs/get_obj?",field:"popular_songs_id",obj:{praise_len:0},query:{song_title:"",music_genre:"",singer_name:"",release_time:"",singer_photos:"",album_name:"",playback_quantity:0,music_audio:"",music_introduction:"",music_content:"",popular_songs_id:0},praise:0,state_praise:!1,state_collect:!1,list_comment:[],form_comment:{source_table:"popular_songs",source_field:"popular_songs_id",source_id:0,reply_to_id:0},count_pages:1}},methods:{add_hits(t){t["hits"]=t["hits"]+1;var s=t["hits"];this.$post("~/api/popular_songs/set?popular_songs_id="+t["popular_songs_id"],{hits:s},t=>{if(t.result){console.log("添加访问量状态：",t.result);var s={source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj.popular_songs_id,user_id:this.$store.state.user.user_id};this.$post("~/api/hits/add?",s,t=>{console.log(t)})}else t.error&&console.error(t.error)})},get_obj_after(t){if(t&&t.result&&t.result.obj){console.log(t.result.obj);var s=t.result.obj;this.obj=s,this.add_hits(s),this.get_praise(s),this.get_collect(s),this.get_comment(s),this.form_comment.source_id=this.obj.popular_songs_id}},get_collect(t){var s=this.user.user_id,e={source_table:"popular_songs",source_field:"popular_songs_id",source_id:t["popular_songs_id"],user_id:s};this.$get("~/api/collect/count?",e,t=>{if(console.log(t),t.result||0===t.result){var s=!!t.result;this.state_collect=s,console.log("收藏状态："+s)}else t.error&&console.error(t.error)})},toShare(t){window.open(t)},change_collect(){var t=this.user.user_id,s={source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj["popular_songs_id"],user_id:t};this.state_collect?(this.state_collect=!1,this.$get("~/api/collect/del?",s,t=>{t.result?this.$toast("取消收藏"):t.error&&(this.$toast(t.error.message),console.error(t.error))})):(this.state_collect=!0,s.title=this.obj.song_title,s.img=this.obj.singer_photos,this.$post("~/api/collect/add?",s,t=>{t.result?this.$toast("收藏成功"):t.error&&(this.$toast(t.error.message),console.error(t.error))}))},get_praise(t){var s=this.user.user_id;this.$get("~/api/praise/count?",{source_table:"popular_songs",source_field:"popular_songs_id",source_id:t["popular_songs_id"]},t=>{t.result||0===t.result?(this.praise=t.result,console.log("点赞数：",t.result)):t.error&&(this.$toast(t.error.message),console.error(t.error))}),this.$get("~/api/praise/count?",{source_table:"popular_songs",source_field:"popular_songs_id",source_id:t["popular_songs_id"],user_id:s},t=>{t.result||0===t.result?(this.state_praise=!!t.result,console.log("点赞状态：",t.result)):t.error&&(this.$toast(t.error.message),console.error(t.error))})},change_praise(t){var s=this.user.user_id,e={source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj["popular_songs_id"],user_id:s},i=this;i.obj.praise_len=parseInt(i.obj.praise_len),this.state_praise?(this.state_praise=!1,this.$get("~/api/praise/del?",e,t=>{if(t.result){var s=i.obj.praise_len-1;this.$post("~/api/popular_songs/set?popular_songs_id="+i.obj["popular_songs_id"],{praise_len:s},t=>{t.result?console.log("添加点赞数状态：",t.result):t.error&&console.error(t.error)}),this.$toast("取消点赞")}else t.error&&(this.$toast(t.error.message),console.error(t.error))})):(this.state_praise=!0,this.$post("~/api/praise/add?",e,t=>{if(t.result){var s=i.obj.praise_len+1;this.$post("~/api/popular_songs/set?popular_songs_id="+i.obj["popular_songs_id"],{praise_len:s},t=>{t.result?console.log("添加点赞数状态：",t.result):t.error&&console.error(t.error)}),this.$toast("点赞成功")}else t.error&&(this.$toast(t.error.message),console.error(t.error))}))},link_gen(t){return{query:this.query}},change_page(t){this.get_comment(this.obj,t),this.form_comment.reply_to_id=0},update_comment(){this.get_comment(this.obj)},get_comment(t,s=1,e=5){this.$get("~/api/comment/get_list?",{source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj["popular_songs_id"],page:s,size:e,reply_to_id:"0",orderby:"create_time desc"},t=>{if(t.result){var s=t.result.list;s.map(t=>{t.list_reply=[]}),this.add_reply(s).then(t=>{this.list_comment=t}),this.count_pages=Math.ceil(t.result.count/e)||1}})},add_reply(t){return new Promise(s=>{for(let e=0;e<t.length;e++){const s=t[e];this.$get("~/api/comment/get_list?",{source_table:"popular_songs",source_field:"popular_songs_id",source_id:this.obj["popular_songs_id"],orderby:"create_time desc",reply_to_id:s.comment_id},t=>{t.result&&(s.list_reply=t.result.list)})}s(t)})}},computed:{respondent(){var t=this.form_comment.reply_to_id,s="";return this.list_comment.map(e=>{e.comment_id===t&&(s=e.nickname)}),s}},mounted(){}},f=v,b=(e("158d"),Object(p["a"])(f,i,r,!1,null,null,null));s["default"]=b.exports},ec52:function(t,s,e){}}]);